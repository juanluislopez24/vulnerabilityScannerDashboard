import shodan
import sys
import json

# Configuration
API_KEY = ''
with open('api-key.json', 'r') as file:
    API_KEY = json.load(file)['key']

try:
    # Setup the api
    api = shodan.Shodan(API_KEY)

    # Perform the search
    query = 'country:"GT" product:"Apache httpd"'
    result = api.search(query, page=1)

    with open('gt.json', 'w') as outfile:
        json.dump(result, outfile, indent = 4)
except Exception as e:
    print('Error: {}'.format(e))
    sys.exit(1)
